---
// Props untuk Input component
const {
  label = "",
  showLabel = true,
  icon = "",
  placeholder = "",
  value = "",
  type = "text",
  name = "",
  id = "",
  required = false,
  disabled = false,
  error = false,
  customClass = "",
  fullWidth = false,
  isDatePicker = false,
} = Astro.props;

// Base classes untuk input
const baseInputClasses = [
  "flex gap-2.5 items-center justify-start px-3 py-2.5 md:px-4 md:py-3 lg:px-5 lg:py-3.5 relative rounded-[25px] md:rounded-[30px] lg:rounded-[50px] w-full transition-all duration-200",
  "border border-[#e4e6eb] border-solid overflow-hidden",
  error ? "border-red-500" : "",
  disabled ? "opacity-50 cursor-not-allowed" : "cursor-text",
  fullWidth ? "w-full" : "",
  customClass,
]
  .filter(Boolean)
  .join(" ");

// Label classes
const labelClasses = [
  "leading-[0] not-italic relative shrink-0 text-16 text-black w-full",
]
  .filter(Boolean)
  .join(" ");

// Icon classes
const iconClasses = ["relative shrink-0 size-5 md:size-5 lg:size-6"]
  .filter(Boolean)
  .join(" ");

// Input text classes
const inputTextClasses = [
  "leading-[0] not-italic relative overflow-hidden shrink-0 text-16 text-black text-nowrap bg-transparent outline-none border-none flex-1 w-full",
  disabled ? "cursor-not-allowed" : "",
]
  .filter(Boolean)
  .join(" ");
---

<div
  class="content-stretch flex flex-col gap-2 items-start justify-start relative size-full p-0.5"
>
  {
    showLabel && label && (
      <div class={labelClasses}>
        <p class="leading-[normal]">{label}</p>
      </div>
    )
  }

  <div
    class={`${baseInputClasses} focus-within:shadow-[0_0_0_2px_#ff48b6]`}
    data-input-container
  >
    {
      icon && (
        <div class={iconClasses} data-name="input-icon">
          <img alt="input icon" class="block max-w-none size-full" src={icon} />
        </div>
      )
    }

    <input
      type={type}
      name={name}
      id={id}
      value={value}
      placeholder={placeholder}
      required={required}
      disabled={disabled}
      class={`${inputTextClasses} focus:outline-none placeholder:text-gray-400${isDatePicker ? " datepicker-input [&::-webkit-calendar-picker-indicator]:hidden [&::-webkit-inner-spin-button]:hidden [&::-webkit-outer-spin-button]:hidden" : ""}`}
      data-input-field
    />
  </div>
</div>

<script>
  // Handle datepicker click events and value updates
  document.addEventListener("DOMContentLoaded", function () {
    // Ambil semua elemen dengan class "datepicker-input"
    const datepickerInputs = document.querySelectorAll('.datepicker-input');
    datepickerInputs.forEach(function(input) {
      const inputId = input.id;
      // Buat instance MCDatepicker untuk setiap input
      const picker = MCDatepicker.create({
        el: `#${inputId}`,
        bodyType: "inline",
        theme: {
          theme_color: "#ff48b6",
          main_background: "#ffffff",
          active_text_color: "#000000",
          inactive_text_color: "rgba(0, 0, 0, 0.3)",
          display: {
            foreground: "#ffffff",
            background: "#ff48b6",
          },
          picker: {
            foreground: "#000000",
            background: "#ffffff",
          },
          picker_header: {
            active: "#000000",
            inactive: "rgba(0, 0, 0, 0.3)",
          },
          weekday: {
            foreground: "#ff48b6",
          },
          button: {
            success: {
              foreground: "#ff48b6",
            },
            danger: {
              foreground: "#e65151",
            },
          },
          date: {
            active: {
              default: {
                foreground: "#000000",
              },
              picked: {
                foreground: "#ffffff",
                background: "#ff48b6",
              },
              today: {
                foreground: "#000000",
                background: "rgba(255, 72, 182, 0.1)",
              },
            },
            inactive: {
              default: {
                foreground: "rgba(0, 0, 0, 0.3)",
              },
              picked: {
                foreground: "#ff48b6",
                background: "rgba(255, 72, 182, 0.1)",
              },
              today: {
                foreground: "rgba(0, 0, 0, 0.3)",
                background: "rgba(0, 0, 0, 0.05)",
              },
            },
            marcked: {
              foreground: "#ff48b6",
            },
          },
          month_year_preview: {
            active: {
              default: {
                foreground: "#000000",
              },
              picked: {
                foreground: "#ffffff",
                background: "#ff48b6",
              },
            },
            inactive: {
              default: {
                foreground: "rgba(0, 0, 0, 0.3)",
              },
              picked: {
                foreground: "rgba(0, 0, 0, 0.3)",
                background: "rgba(0, 0, 0, 0.05)",
              },
            },
          },
        },
      });
    });
  });
</script>
